<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Começar Agora | Cadastro Odoo</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
    <div class="onboarding-container">
        <header class="text-center">
            <h1 class="onboarding-title">Começar agora</h1>
            <p class="text-muted">Acesso instantâneo gratuito, sem necessidade de cartão de crédito.</p>
        </header>

        <form id="onboarding-form" class="onboarding-form">
            <div class="form-group-row">
                <div class="form-group">
                    <label for="name">Nome e sobrenome</label>
                    <input type="text" id="name" name="name" required placeholder="Arca, Adriano Justino Rosa">
                </div>
                <div class="form-group">
                    <label for="company_name">Nome da empresa</label>
                    <input type="text" id="company_name" name="company_name" required placeholder="Nome da Empresa">
                </div>
            </div>

            <div class="form-group-row">
                <div class="form-group">
                    <label for="email">E-mail</label>
                    <input type="email" id="email" name="email" required placeholder="adrianajustinor@gmail.com">
                </div>
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" name="password" required placeholder="Crie uma senha forte">
                </div>
            </div>
            
            <div class="form-group-row">
                <div class="form-group">
                    <label for="phone">Número de telefone</label>
                    <input type="tel" id="phone" name="phone" placeholder="+55 14 99861-2313">
                </div>
                <div class="form-group">
                    <label for="country">País</label>
                    <select id="country" name="country">
                        <option value="Brasil">Brasil</option>
                    </select>
                </div>
            </div>

            <div id="feedback-message" class="feedback-message"></div>

            <p class="terms-text">
                Ao clicar em <strong>Começar agora</strong>, você aceita nossa 
                <a href="#">Contrato de Assinatura</a> e 
                <a href="#">Política de Privacidade</a>
            </p>

            <button type="submit" id="submit-button" class="btn-submit">Comece Agora</button>
        </form>
    </div>

    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="spinner-box">
            <div class="pulse-container">
                <div class="pulse-bubble pulse-bubble-1"></div>
                <div class="pulse-bubble pulse-bubble-2"></div>
                <div class="pulse-bubble pulse-bubble-3"></div>
            </div>
            <p class="loading-text">Processando seu ambiente... Por favor, aguarde.</p>
        </div>
    </div>
    
    <script>
        document.getElementById('onboarding-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const form = e.target;
            const formData = new FormData(form);
            const feedback = document.getElementById('feedback-message');
            const loadingOverlay = document.getElementById('loading-overlay');
            const submitButton = document.getElementById('submit-button');

            // 1. Coleta os dados em um objeto JSON (apenas campos necessários)
            const payload = {
                company_name: formData.get('company_name'),
                name: formData.get('name'),
                email: formData.get('email'),
                password: formData.get('password'),
                phone: formData.get('phone'),
            };

            // Para simular a estrutura JSON-RPC esperada pelo Odoo
            const jsonRpcPayload = {
                jsonrpc: "2.0",
                method: "call",
                params: payload,
                id: Math.random()
            };
            
            // 2. Mostra o loading state e desabilita o botão
            loadingOverlay.classList.remove('hidden');
            submitButton.disabled = true;
            feedback.innerHTML = '';
            
            try {
                // 3. Chama o endpoint Odoo (AJUSTE ESTA URL SE NECESSÁRIO)
                const response = await fetch('https://erp.inetz.com.br/saas/onboard', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonRpcPayload),
                });
                
                const result = await response.json();

                // Verifica o resultado dentro do JSON-RPC
                if (result.error) {
                    throw new Error(result.error.message || "Erro desconhecido na API Odoo.");
                }

                if (result.result && result.result.status === 'sucesso') {
                    // 4. Sucesso: Redireciona para a página final de sucesso, passando os dados
                    const params = new URLSearchParams({
                        name: payload.name,
                        company: payload.company_name,
                        email: payload.email,
                        // Não passamos a senha, apenas dados de identificação
                    });
                    
                    window.location.href = 'success.html?' + params.toString();
                    
                } else {
                    // 5. Erro Lógico retornado pelo Odoo
                    throw new Error(result.result.mensagem || "Falha na criação do ambiente. Tente novamente.");
                }

            } catch (error) {
                // 6. Falha: Esconde o loading e exibe o erro
                console.error("Erro na integração:", error);
                loadingOverlay.classList.add('hidden');
                submitButton.disabled = false;
                
                feedback.classList.remove('success');
                feedback.classList.add('error');
                feedback.innerHTML = `<strong>Erro:</strong> ${error.message}`;
            }
        });
    </script>
</body>
</html>
